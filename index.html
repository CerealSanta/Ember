<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Forest Fire Spread</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0b0f0c" />
<style>
  body { background:#0b0f0c; margin:0; font-family:sans-serif; color:#fff; display:flex; flex-direction:column; align-items:center; padding:10px; }
  #game { display:grid; gap:1px; background:#333; }
  .cell { width:24px; height:24px; }
  .tree { background:green; }
  .fire { background:orange; }
  .burned { background:#444; }
  .rock { background:gray; }
  .water { background:blue; }
  #ui { margin-top:10px; display:flex; flex-direction:column; gap:6px; align-items:center; }
  button { padding:6px 12px; border:none; border-radius:4px; background:#444; color:white; cursor:pointer; }
  button:disabled { background:#222; color:#777; }
</style>
</head>
<body>
<h1>ðŸ”¥ Forest Fire</h1>
<div id="game"></div>
<div id="ui">
  <div>Points: <span id="points">0</span></div>
  <div>Level: <span id="level">1</span></div>
  <div>Spread Speed: <span id="speed">1000</span>ms</div>
  <div>Extra Starts: <span id="starts">0</span></div>
  <button id="upgradeSpeed">Upgrade Speed (10 pts)</button>
  <button id="upgradeStarts">Upgrade Starts (15 pts)</button>
  <button id="nextLevel" disabled>Next Level</button>
</div>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}
let gridSize = 10;
let level = 1;
let grid = [];
let points = 0;
let spreadSpeed = 1000;
let extraStarts = 0;
let firesPlaced = 0;
const gameEl = document.getElementById('game');
const pointsEl = document.getElementById('points');
const levelEl = document.getElementById('level');
const speedEl = document.getElementById('speed');
const startsEl = document.getElementById('starts');
const nextLevelBtn = document.getElementById('nextLevel');
function createLevel(){
  gameEl.style.gridTemplateColumns = `repeat(${gridSize}, 24px)`;
  grid = [];
  gameEl.innerHTML = '';
  for(let i=0;i<gridSize*gridSize;i++){
    let type = 'tree';
    if(Math.random()<0.1) type='rock';
    if(Math.random()<0.05) type='water';
    const cell = { type, el: document.createElement('div') };
    cell.el.className = 'cell '+type;
    cell.el.addEventListener('click', ()=>{
      if((firesPlaced < 1+extraStarts) && cell.type==='tree'){
        cell.type='fire';
        cell.el.className='cell fire';
        firesPlaced++;
      }
    });
    grid.push(cell);
    gameEl.appendChild(cell.el);
  }
}
function spreadFire(){
  let newFires = [];
  grid.forEach((cell,idx)=>{
    if(cell.type==='fire'){
      cell.type='burned';
      cell.el.className='cell burned';
      points++;
      const x = idx%gridSize, y=Math.floor(idx/gridSize);
      const dirs = [[1,0],[-1,0],[0,1],[0,-1]];
      dirs.forEach(([dx,dy])=>{
        const nx=x+dx, ny=y+dy;
        if(nx>=0 && nx<gridSize && ny>=0 && ny<gridSize){
          const ncell = grid[ny*gridSize+nx];
          if(ncell.type==='tree') newFires.push(ncell);
        }
      });
    }
  });
  newFires.forEach(c=>{c.type='fire'; c.el.className='cell fire';});
  updateUI();
  if(grid.every(c=>c.type!=='tree' && c.type!=='fire')){
    clearInterval(loop);
    nextLevelBtn.disabled=false;
  }
}
function updateUI(){
  pointsEl.textContent = points;
  levelEl.textContent = level;
  speedEl.textContent = spreadSpeed;
  startsEl.textContent = extraStarts;
}
document.getElementById('upgradeSpeed').onclick=()=>{
  if(points>=10){ points-=10; spreadSpeed=Math.max(200,spreadSpeed-200); restartLoop(); updateUI(); }
};
document.getElementById('upgradeStarts').onclick=()=>{
  if(points>=15){ points-=15; extraStarts++; updateUI(); }
};
nextLevelBtn.onclick=()=>{
  level++;
  gridSize += 2;
  firesPlaced=0;
  nextLevelBtn.disabled=true;
  createLevel();
  restartLoop();
};
function restartLoop(){
  clearInterval(loop);
  loop=setInterval(spreadFire, spreadSpeed);
}
createLevel();
let loop=setInterval(spreadFire, spreadSpeed);
updateUI();
</script>
</body>
</html>